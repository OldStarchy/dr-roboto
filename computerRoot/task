-- global taskManager

local cli = Cli('task', 'Cli interface for the TaskManager', 'list')

cli:addAction(
	'list',
	function()
		local tasks = taskManager:getTasks()

		print(#tasks .. ' tasks:')
		for i, task in ipairs(tasks) do
			print(' ' .. i .. ': ' .. tostring(task))
		end
	end,
	nil,
	'Lists queued tasks'
)

cli:addAction(
	'add',
	function(name)
		if (not isType(name, 'string')) then
			print('Must specifiy name')
			return
		end

		local task = Task(name)
		taskManager:addTask(task)
	end,
	'name',
	'Queues a task for completion'
)

cli:addAction(
	'run',
	function()
		print('Start executing tasks? [Y/n] ')

		os.pullEvent('key')

		while (true) do
			local e, cc = os.pullEvent('key_up')

			if (cc == 28 or cc == 21) then
				break
			elseif (cc == 49) then
				return
			end
			os.pullEvent('key')
		end

		local skillSet = SkillSet.GetDefaultSkillSet()

		local runner = TaskRunner(skillSet, taskManager, true)

		runner:run()
	end,
	nil,
	'Runs the currently queued tasks'
)

cli:run(...)
